import pybullet as p
import time
import pybullet_data
import numpy as np
from PIL import Image
physicsClient = p.connect(p.GUI)#or p.DIRECT for non-graphical version
p.setAdditionalSearchPath(pybullet_data.getDataPath()) #optionally
p.setGravity(0,0,-10)
# planeId = p.loadURDF("plane.urdf")
startPos = [0,0,1]
startOrientation = p.getQuaternionFromEuler([0,0,0])
startPos = [0, 0, -0.108]
startOrientation = p.getQuaternionFromEuler([0, 0, -np.pi / 2])

boxId= p.loadURDF(
    # 'DOF4ARM0/urdf/DOF4ARM0.urdf',
    '4dof_2nd/urdf/4dof_2nd.urdf',
    startPos,
    startOrientation,
    flags=p.URDF_USE_SELF_COLLISION,  # no mold penetration
    useFixedBase=1)
view_matrix = p.computeViewMatrix(
    cameraEyePosition=[-0.8,0.8,0.8],
    cameraTargetPosition=[0, 0, 0],
    cameraUpVector=[0, 0, 1])
projection_matrix = p.computeProjectionMatrixFOV(
    fov=42,
    aspect=1.0,
    nearVal=0.1,
    farVal=200)
#set the center of mass frame (loadURDF sets base link frame) startPos/Ornp.resetBasePositionAndOrientation(boxId, startPos, startOrientation)
for i in range (10000):
    # Capture the image
    debug_points = p.addUserDebugPoints([[0.1,-0.1,0.1]], [[0,1,0]], pointSize=10, lifeTime=-1)

    width, height, rgba, depth, _ = p.getCameraImage(width=480, height=480,viewMatrix=view_matrix,projectionMatrix=projection_matrix)
    # Convert the image data to a numpy array and reshape
    image_np = np.array(rgba, dtype=np.uint8).reshape((height, width, 4))

    # Convert the numpy array to a PIL image and save
    img = Image.fromarray(image_np)
    img.save("screenshot.png")

    p.stepSimulation()
    time.sleep(1./240.)
cubePos, cubeOrn = p.getBasePositionAndOrientation(boxId)
print(cubePos,cubeOrn)
p.disconnect()
# import numpy as np
# trj = [[-0.5, -0.3, -0.5, -0.2], [-0.5246821306785537, -0.2743351778508575, -0.4768512233185882, -0.21471146613335257], [-0.5429153020491665, -0.25419529878524383, -0.4557389903777426, -0.22270757584924522], [-0.5552997463422904, -0.23890389832852438, -0.4364709191629641, -0.22465418280832167], [-0.5624356957883777, -0.22778451200606434, -0.4188546276597536, -0.22121714067122542], [-0.56492338261788, -0.22016067534322908, -0.402697733853612, -0.2130623030986], [-0.5633630390612497, -0.21535592386538385, -0.3878078557300403, -0.20085552375108903], [-0.5583548973489391, -0.21269379309789402, -0.3739926112745392, -0.18526265628933614], [-0.5504991897113997, -0.21149781856612473, -0.3610596184726097, -0.1669495543739848], [-0.540396148379084, -0.2110915357954414, -0.3488164953097527, -0.14658207166567858], [-0.5286460055824439, -0.21079848031120932, -0.3370708597714692, -0.12482606182506113], [-0.5158489935519316, -0.20994218763879377, -0.32563032984326, -0.10234737851277602], [-0.5026053445179992, -0.20784619330356005, -0.31430252351062604, -0.07981187538946678], [-0.48951529071109856, -0.20383403283087345, -0.30289505875906825, -0.05788540611577699], [-0.47717906436168206, -0.1972292417460993, -0.29121555357408746, -0.03723382435235024], [-0.46610225539542327, -0.18749606028748597, -0.27908024662938136, -0.018435582467360073], [-0.45620638803304575, -0.17496705916676927, -0.26635857741978824, -0.0015297535564684434], [-0.44719040181551706, -0.16030572573524354, -0.25294026002164627, 0.013650144176212575], [-0.43875279812498563, -0.14417619875491083, -0.23871504842188682, 0.027270997162184122], [-0.43059207834360086, -0.12724261698777323, -0.22357269660744172, 0.03949969183294742], [-0.42240674385351124, -0.11016911919583287, -0.2074029585652425, 0.05050311462000364], [-0.413895296036866, -0.09361984414109183, -0.19009558828222073, 0.060448151954853965], [-0.4047895117164852, -0.0781810602156576, -0.1715846339597746, 0.0695054872794719], [-0.39507869612567564, -0.06383637414350572, -0.15214694973710902, 0.07787519021530151], [-0.38487228108859745, -0.05028827534782788, -0.1322192948627541, 0.0857710378483395], [-0.3742803734383504, -0.037237673612456335, -0.11223932711551078, 0.09340688428883709], [-0.36341308000803413, -0.024385478721223534, -0.09264470427418028, 0.10099658364704546], [-0.3523805076307481, -0.011432600457961867, -0.0738730841175636, 0.10875399003321577], [-0.341292763139592, 0.0019200513934962901, -0.05636212442446183, 0.11689295755759922], [-0.3302393874802929, 0.015928528512476527, -0.04050217407926762, 0.12560762971885855], [-0.3191078823210316, 0.030426071992367847, -0.026218819387705688, 0.13489851296741098], [-0.3076710739419996, 0.04500594004512817, -0.01317385226027927, 0.14465620738345641], [-0.29570047240659714, 0.059258636416357244, -0.0010260368382497718, 0.15477005156805293], [-0.2829675877782241, 0.072774664851655, 0.010565862737121613, 0.1651293841222587], [-0.2692439301202805, 0.08514452909662143, 0.021943082324573707, 0.175623543647132], [-0.25430100949616635, 0.09595873289685622, 0.033446857782845105, 0.1861418687437308], [-0.23792865565634008, 0.1048362149001918, 0.04539663397797905, 0.19657235036414344], [-0.2201491749287328, 0.11175675227373538, 0.05783532837762692, 0.20678587781351443], [-0.20114467458778384, 0.11694815722340886, 0.07061577762289506, 0.21664158497888114], [-0.18110040314371087, 0.1206431176242408, 0.08358708190209524, 0.2259983746689249], [-0.1602016091067313, 0.12307432135125998, 0.09659834140353957, 0.23471514969232726], [-0.13863354098706293, 0.12447445627949515, 0.10949865631553986, 0.24265081285776977], [-0.11658144729492306, 0.125076210283975, 0.12213712682640822, 0.24966426697393393], [-0.09422880432048192, 0.12509931951770284, 0.1343600215102334, 0.2556231094481137], [-0.07172932059529624, 0.124545971677785, 0.14596604667095156, 0.26054097977367136], [-0.049212004334009206, 0.12323783983559763, 0.15671444298926487, 0.2645526984121299], [-0.02680511609593087, 0.12099113305478747, 0.16636325655862527, 0.2677967538588021], [-0.004636916440371801, 0.11762206039900112, 0.17467053347248457, 0.27041163460900064], [0.017164334073357865, 0.1129468309318853, 0.18139431982429474, 0.27253582915803837], [0.03847037488594793, 0.10678165371708662, 0.18629266170750763, 0.27430782600122783], [0.05915957564308485, 0.0989551018083757, 0.18914908432458274, 0.27586174118728624], [0.07926280070538709, 0.0895801200323741, 0.19033313238515442, 0.2772311244932331], [0.09896340914840417, 0.07905402498855436, 0.19080037010603187, 0.2783489594243902], [0.11845139025268299, 0.06778649726651279, 0.1915318408130319, 0.27914385703948336], [0.13791673329877008, 0.05618721745584599, 0.19350858783197133, 0.279544428397239], [0.15754942756721246, 0.04466586614615027, 0.197711654488667, 0.27947928455638305], [0.17753946233855653, 0.03363212392702219, 0.20512208410893562, 0.27887703657564183], [0.1980664530828226, 0.02348336207472613, 0.21668663038164734, 0.2776718281122698], [0.21896729530744627, 0.014210288625078862, 0.23221921898987347, 0.27598058348601634], [0.23966585317481962, 0.005313518583088467, 0.2501685400715801, 0.2741405064024849], [0.25956140107423553, -0.0037355106778389257, 0.2689020046253048, 0.27250191487490166], [0.27805321339498607, -0.013465361784296862, 0.28678702364958414, 0.27141512691649305], [0.29454056452636346, -0.02440459736287901, 0.3021910081429551, 0.27123046054048544], [0.30842272885765987, -0.037081780040178855, 0.3134813691039545, 0.27229823376010515], [0.31910911131633746, -0.0520172734567033, 0.3190463825184059, 0.2749602158523394], [0.3265244775676122, -0.0693143424327375, 0.3183357680053651, 0.27912328478421716], [0.33134333414554284, -0.08846946122623472, 0.3123434211629782, 0.2840616436511801], [0.3342992688827921, -0.10893128760828925, 0.3021849221952453, 0.2889996393189234], [0.33612586961202273, -0.13014847934999468, 0.28897585130616665, 0.2931616186531421], [0.3375567241658973, -0.1515696942224447, 0.2738317886997427, 0.29577192851953094], [0.3393254203770786, -0.17264358999673296, 0.25786831457997367, 0.2960549157837853], [0.34216073195058033, -0.19282240873057066, 0.24219653463128224, 0.2932404250871768], [0.3463720017199967, -0.21187067345317423, 0.22753771201992803, 0.28703729476811485], [0.3515296039248003, -0.2301030951894695, 0.21392627115706978, 0.27799827171606256], [0.35712869205994774, -0.2478903894427727, 0.20132672208547273, 0.2667620055638725], [0.36266441962039603, -0.26560327171640064, 0.18970357484790162, 0.2539671459443966], [0.36763194010110184, -0.2836124575136695, 0.17902133948712168, 0.24025234249048752], [0.3715264069970219, -0.30228866233789564, 0.16924452604589796, 0.22625624483499732], [0.3738451454230765, -0.32200117725536154, 0.16033748112799917, 0.21261770950474715], [0.3744719484173243, -0.3428657962972693, 0.15223546524912146, 0.2000124124902266], [0.37411912224909294, -0.36445486438798014, 0.14481138392116702, 0.18919496366231184], [0.3736060260088749, -0.3862705069817834, 0.1379300857188425, 0.1809301719982562], [0.3737520187871627, -0.40781484953296965, 0.1314564192168543, 0.17598284647531293], [0.3753764596744487, -0.42859001749582853, 0.12525523298990912, 0.17511779607073547], [0.3792987077612255, -0.4480981363246499, 0.11919137561271358, 0.17909982976177719], [0.38633732750305905, -0.4658413828812467, 0.11312922898938334, 0.18869216881867404], [0.39690720881285935, -0.4813480490492479, 0.10669610636383288, 0.20385147934689754], [0.4103639932465275, -0.49421495294078593, 0.09889724908224465, 0.22241801399792033], [0.4258916812158429, -0.5040500166930169, 0.0886370976431564, 0.24188908070748802], [0.44267427313258517, -0.5104611624430969, 0.07482009254510613, 0.25976198741134626], [0.45989576940853405, -0.5130563123281827, 0.05635067428663133, 0.2735340420452413], [0.4767401704554692, -0.5114433884854305, 0.03213328336626996, 0.2807025525449187], [0.49239147668516986, -0.5052303130519964, 0.001072360282559734, 0.2787648268461242], [0.5060336885094159, -0.49402500816503714, -0.03792765446596089, 0.2652181728846039], [0.5168508063399867, -0.47743539596170853, -0.08596232038075519, 0.23755989859610321], [0.5240268305886622, -0.45506939857916706, -0.14412719696328485, 0.19328731191636805], [0.5267457616672215, -0.42653493815456955, -0.21351784371501115, 0.12989772078114514], [0.5241915999874447, -0.3914399368250715, -0.29522982013739807, 0.0448884331261786], [0.515548345961111, -0.34939231672782955, -0.39035868573190696, -0.06424324311278505], [0.5, -0.3, -0.5, -0.2]]
# np.savetxt('planning/trajectory/smooth_fcl_169.csv',trj)
